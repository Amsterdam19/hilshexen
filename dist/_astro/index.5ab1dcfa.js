const f=new Set,i=new WeakSet;let s,d,l=!1;function v(e){l||(l=!0,s??=e?.prefetchAll??!1,d??=e?.defaultStrategy??"hover",g(),p(),w())}function g(){for(const e of["touchstart","mousedown"])document.body.addEventListener(e,t=>{c(t.target,"tap")&&u(t.target.href,{with:"fetch",ignoreSlowConnection:!0})},{passive:!0})}function p(){let e;document.body.addEventListener("focusin",n=>{c(n.target,"hover")&&t(n)},{passive:!0}),document.body.addEventListener("focusout",o,{passive:!0}),m(()=>{for(const n of document.getElementsByTagName("a"))i.has(n)||c(n,"hover")&&(i.add(n),n.addEventListener("mouseenter",t,{passive:!0}),n.addEventListener("mouseleave",o,{passive:!0}))});function t(n){const r=n.target.href;e&&clearTimeout(e),e=setTimeout(()=>{u(r,{with:"fetch"})},80)}function o(){e&&(clearTimeout(e),e=0)}}function w(){let e;m(()=>{for(const t of document.getElementsByTagName("a"))i.has(t)||c(t,"viewport")&&(i.add(t),e??=y(),e.observe(t))})}function y(){const e=new WeakMap;return new IntersectionObserver((t,o)=>{for(const n of t){const r=n.target,a=e.get(r);n.isIntersecting?(a&&clearTimeout(a),e.set(r,setTimeout(()=>{o.unobserve(r),e.delete(r),u(r.href,{with:"link"})},300))):a&&(clearTimeout(a),e.delete(r))}})}function u(e,t){const o=t?.ignoreSlowConnection??!1;if(E(e,o))if(f.add(e),(t?.with??"link")==="link"){const n=document.createElement("link");n.rel="prefetch",n.setAttribute("href",e),document.head.append(n)}else fetch(e).catch(n=>{console.log(`[astro] Failed to prefetch ${e}`),console.error(n)})}function E(e,t){if(!navigator.onLine||!t&&h())return!1;try{const o=new URL(e,location.href);return location.origin===o.origin&&location.pathname!==o.pathname&&!f.has(e)}catch{}return!1}function c(e,t){if(e?.tagName!=="A")return!1;const o=e.dataset.astroPrefetch;return o==="false"?!1:t==="tap"&&(o!=null||s)&&h()?!0:o==null&&s||o===""?t===d:o===t}function h(){if("connection"in navigator){const e=navigator.connection;return e.saveData||/(2|3)g/.test(e.effectiveType)}return!1}function m(e){e();let t=!1;document.addEventListener("astro:page-load",()=>{if(!t){t=!0;return}e()})}export{v as i};
